# Paste the entire prompt from the artifact here
# DJ Library Manager - Claude Code Agent Handoff Prompt

## Project Overview
I'm building a **professional DJ Library Manager** application - a full-stack music library management system with advanced audio analysis, smart crate organization, and Serato DJ software integration. The project uses **Node.js/TypeScript backend** with **React/TypeScript frontend**.

## Current Project Status

### âœ… **Completed Setup**
1. **Project Structure**: Created complete frontend and backend folder structures
2. **Technology Stack Decided**: 
   - Backend: Node.js, Express, TypeScript, SQLite, FFmpeg
   - Frontend: React 18, TypeScript, Redux Toolkit, React Query, shadcn/ui, Tailwind CSS
3. **Git Repository**: Initialized with proper `.gitignore` files for frontend, backend, and root
4. **Environment Configuration**: Created `.env.example` files for both frontend and backend
5. **Documentation**: Created comprehensive backend README.md

### ğŸ“‹ **Technology Stack Details**

#### **Backend Stack:**
- **Runtime**: Node.js 20.14.0+
- **Framework**: Express.js
- **Language**: TypeScript
- **Database**: SQLite with better-sqlite3
- **Audio Processing**: 
  - `music-metadata` for metadata extraction
  - `node-fft` for FFT analysis
  - `wav-decoder` for audio decoding
  - `fluent-ffmpeg` for audio conversion
- **Key Libraries**:
  - `xml2js` for Serato file parsing
  - `chokidar` for file watching
  - `bcryptjs`, `jsonwebtoken` for authentication
  - `cors`, `helmet`, `morgan` for middleware

#### **Frontend Stack:**
- **Framework**: React 18 with TypeScript
- **State Management**: Redux Toolkit
- **Server State**: @tanstack/react-query
- **Routing**: react-router-dom v6
- **UI Library**: shadcn/ui (NEW `shadcn` CLI, not deprecated `shadcn-ui`)
- **Styling**: Tailwind CSS with CSS variables
- **Icons**: lucide-react
- **Audio**: Howler.js
- **Notifications**: Sonner (NOT deprecated toast)
- **Drag & Drop**: @dnd-kit
- **HTTP Client**: axios
- **WebSocket**: Native WebSocket API

### ğŸ¯ **Core Features to Implement**

#### **Backend Features:**
1. **Audio Analysis Service** (`AudioAnalyzer.js`):
   - BPM detection using autocorrelation
   - Key detection using Krumhansl-Schmuckler algorithm
   - Energy analysis (RMS energy, dynamic range)
   - Danceability calculation (beat stability, rhythm regularity)
   - Valence/mood analysis (spectral features)
   - Loudness analysis (LUFS-style)
   - Waveform generation (2000 points for visualization)
   - Spectral features (centroid, rolloff, bandwidth, MFCC)

2. **Library Management** (`LibraryScanner.js`):
   - Recursive music file scanning
   - Metadata extraction
   - Duplicate detection (file hash-based)
   - Batch audio analysis
   - Progress tracking
   - File format support: MP3, WAV, FLAC, AAC, M4A, OGG

3. **Smart Crate System** (20+ pre-built crates):
   - **Energy-based**: Low (60-90 BPM), Medium (90-120), High (120-140), Ultra High (140+)
   - **Event types**: Warm-up, Opening, Peak Time, Closing, Corporate, Wedding, Kids, Religious
   - **Genre collections**: Hip Hop, Electronic/House, Pop, Rock, Classic Evergreens
   - **Special purpose**: Cocktail Hour, Dinner Sets, Ceremony music
   - Smart crate rule engine with AND/OR logic

4. **Serato Integration** (`SeratoSyncService.js`):
   - Import Serato crates (binary `.crate` format)
   - Export to Serato crates
   - Import/export playlists (M3U/M3U8 format)
   - Bidirectional sync functionality
   - Auto-detect Serato path (Windows/macOS/Linux)

5. **Database Schema** (SQLite):
   - `tracks` table (metadata, audio features, technical data)
   - `crates` table (static, smart, folder types)
   - `playlists` table (manual, smart types)
   - `crate_tracks` junction table
   - `playlist_tracks` junction table
   - `play_history` table for analytics

6. **API Endpoints**:
   - `/api/library/*` - Track management, scanning, stats
   - `/api/crates/*` - Crate CRUD, smart crates
   - `/api/playlists/*` - Playlist management, export
   - `/api/search/*` - Advanced search with filters
   - `/api/analytics/*` - Play stats, trends
   - `/api/serato/*` - Serato sync operations

7. **Real-time Features**:
   - WebSocket server for live updates
   - Scan progress broadcasting
   - Track addition notifications
   - Crate update events

#### **Frontend Features:**
1. **State Management**:
   - Redux slices created: library, crates, playlists, search, audio, ui, auth
   - Notification middleware to bridge Redux and Sonner toasts
   - React Query for server state caching

2. **Core Components**:
   - App layout with responsive sidebar
   - Header with scan progress indicator
   - Audio player with Howler.js integration
   - Library page with table/grid/artwork views
   - Crates management page
   - Playlists page
   - Search page with advanced filters
   - Analytics dashboard

3. **UI Components** (shadcn/ui):
   - Installed: button, card, input, label, select, textarea
   - Installed: table, badge, avatar, progress, skeleton
   - Installed: sonner (notifications), alert, dialog, dropdown-menu, popover, tooltip
   - Installed: tabs, separator, accordion, sheet
   - Installed: form, slider, toggle, radio-group, checkbox, switch

4. **Features Implemented**:
   - Dark theme with CSS variables
   - Mobile-responsive design
   - Error boundaries
   - Loading states
   - WebSocket integration for real-time updates
   - Theme provider (dark/light/system)

### ğŸ”§ **Configuration Files Status**

#### **Backend:**
- âœ… `package.json` - Dependencies defined
- âœ… `tsconfig.json` - TypeScript configuration
- âœ… `.env.example` - Environment template
- âœ… `.gitignore` - Excludes: node_modules, .env, database/*.db, uploads/, temp/, *.mp3, logs/
- âš ï¸ **Need to create**: Actual service files, route handlers, middleware

#### **Frontend:**
- âœ… `package.json` - All dependencies installed
- âœ… `tsconfig.json` - Path aliases configured (`@/*` â†’ `src/*`)
- âœ… `tailwind.config.js` - Dark theme with CSS variables
- âœ… `components.json` - shadcn/ui configuration
- âœ… `.env.example` - API URL configuration
- âœ… `.gitignore` - Standard React exclusions
- âœ… `src/index.css` - Tailwind + custom DJ-specific styles
- âœ… `src/lib/utils.ts` - Utility functions (cn, formatDuration, formatBPM, etc.)
- âš ï¸ **Need to create**: Complete page components, API integration

### ğŸ“‚ **Current Folder Structure**

```
dj-library-manager/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/      # Route handlers (TO CREATE)
â”‚   â”‚   â”œâ”€â”€ services/         # Business logic (TO CREATE)
â”‚   â”‚   â”‚   â”œâ”€â”€ AudioAnalyzer.js
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseService.js
â”‚   â”‚   â”‚   â”œâ”€â”€ LibraryScanner.js
â”‚   â”‚   â”‚   â”œâ”€â”€ SeratoSyncService.js
â”‚   â”‚   â”‚   â””â”€â”€ FileWatcherService.js
â”‚   â”‚   â”œâ”€â”€ models/           # Database models (TO CREATE)
â”‚   â”‚   â”œâ”€â”€ middleware/       # Express middleware (TO CREATE)
â”‚   â”‚   â”œâ”€â”€ utils/            # Utility functions (TO CREATE)
â”‚   â”‚   â”œâ”€â”€ routes/           # API routes (TO CREATE)
â”‚   â”‚   â”‚   â”œâ”€â”€ library.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ crates.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ playlists.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ search.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.ts
â”‚   â”‚   â”‚   â””â”€â”€ serato.ts
â”‚   â”‚   â”œâ”€â”€ config/           # Configuration (TO CREATE)
â”‚   â”‚   â””â”€â”€ server.ts         # Main Express server (TO CREATE)
â”‚   â”œâ”€â”€ temp/                 # Temporary files (gitignored)
â”‚   â”œâ”€â”€ uploads/              # File uploads (gitignored)
â”‚   â”œâ”€â”€ database/             # SQLite database (gitignored)
â”‚   â”œâ”€â”€ .env.example          # âœ… Created
â”‚   â”œâ”€â”€ .gitignore            # âœ… Created
â”‚   â”œâ”€â”€ package.json          # âœ… Created
â”‚   â””â”€â”€ tsconfig.json         # âœ… Created
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/           # shadcn/ui components (âœ… Installed)
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/       # Header, Sidebar, Footer (âœ… Created)
â”‚   â”‚   â”‚   â””â”€â”€ common/       # LoadingSpinner, ErrorBoundary (âœ… Created)
â”‚   â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”‚   â”œâ”€â”€ library/      # LibraryPage (âœ… Created)
â”‚   â”‚   â”‚   â”œâ”€â”€ crates/       # CratesPage (âœ… Created)
â”‚   â”‚   â”‚   â”œâ”€â”€ playlists/    # PlaylistsPage (âœ… Created)
â”‚   â”‚   â”‚   â”œâ”€â”€ search/       # SearchPage (âœ… Created)
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/    # AnalyticsPage (âœ… Created)
â”‚   â”‚   â”‚   â””â”€â”€ audio/        # AudioPlayer (âœ… Created)
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â”œâ”€â”€ slices/       # Redux slices (âœ… Created)
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/   # notificationMiddleware (âœ… Created)
â”‚   â”‚   â”‚   â””â”€â”€ index.ts      # Store config (âœ… Created)
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.ts        # API client (âœ… Created)
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts      # TypeScript types (âœ… Created)
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts      # Utilities (âœ… Created)
â”‚   â”‚   â”œâ”€â”€ hooks/            # Custom hooks (TO ENHANCE)
â”‚   â”‚   â”œâ”€â”€ constants/        # Constants (TO CREATE)
â”‚   â”‚   â”œâ”€â”€ App.tsx           # Main app (âœ… Created)
â”‚   â”‚   â”œâ”€â”€ index.tsx         # Entry point (âœ… Created)
â”‚   â”‚   â””â”€â”€ index.css         # Global styles (âœ… Created)
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ .env.example          # âœ… Created
â”‚   â”œâ”€â”€ .gitignore            # âœ… Created
â”‚   â”œâ”€â”€ components.json       # âœ… Created
â”‚   â”œâ”€â”€ package.json          # âœ… Created
â”‚   â”œâ”€â”€ tailwind.config.js    # âœ… Created
â”‚   â””â”€â”€ tsconfig.json         # âœ… Created
â”œâ”€â”€ .gitignore                # âœ… Created (root)
â”œâ”€â”€ README.md                 # âœ… Created
â””â”€â”€ LICENSE                   # âœ… Created (MIT)
```

### ğŸš§ **What Needs to Be Built Next**

#### **Backend Priority Tasks:**
1. **Create `server.ts`**: Express server setup with CORS, middleware, WebSocket
2. **Implement `DatabaseService.js`**: SQLite initialization, CRUD operations
3. **Implement `AudioAnalyzer.js`**: Complete audio analysis algorithms
4. **Implement `LibraryScanner.js`**: File scanning with progress tracking
5. **Implement `SeratoSyncService.js`**: Serato integration
6. **Create API routes**: All CRUD endpoints for tracks, crates, playlists
7. **Add authentication**: JWT-based auth middleware
8. **Create CLI interface**: Command-line tool for library management

#### **Frontend Priority Tasks:**
1. **Complete LibraryPage**: Track table with sorting, filtering, selection
2. **Build TrackRow component**: Individual track display with metadata
3. **Implement audio player controls**: Play/pause, seek, volume
4. **Create crate management UI**: Drag-drop tracks to crates
5. **Build playlist builder**: Track ordering, export functionality
6. **Implement search filters**: Genre, BPM, key, energy range filters
7. **Add analytics visualizations**: Charts for play stats, genre distribution
8. **Connect WebSocket**: Real-time scan progress, notifications

### âš ï¸ **Important Notes & Decisions Made**

1. **shadcn/ui CLI**: Use NEW `npx shadcn@latest` (not deprecated `shadcn-ui`)
2. **Notifications**: Use `sonner` component (toast is deprecated)
3. **Node Version**: Requires Node.js 20.19.0+ (current: 20.14.0 has warnings but works)
4. **Path Aliases**: Frontend uses `@/*` for `src/*` imports
5. **Theme**: Dark theme optimized for DJ use with CSS variables
6. **Database**: SQLite for simplicity, can migrate to PostgreSQL later
7. **Audio Files**: Stored outside repo, only metadata in database
8. **Serato Files**: Auto-detected paths for Windows/macOS/Linux

### ğŸ¯ **Immediate Next Steps for Claude Code Agent**

1. **Backend Implementation**:
   - Create complete `server.ts` with Express setup
   - Implement `DatabaseService.js` with schema creation
   - Build `AudioAnalyzer.js` with all analysis algorithms
   - Create API route handlers
   - Set up WebSocket server

2. **Frontend Completion**:
   - Enhance LibraryPage with full track management
   - Build complete audio player with waveform display
   - Implement drag-drop for crates
   - Add advanced search filters
   - Connect all API endpoints

3. **Testing & Integration**:
   - Test audio analysis with sample files
   - Verify Serato sync functionality
   - Test WebSocket real-time updates
   - Ensure mobile responsiveness

### ğŸ“š **Reference Information**

#### **Backend Environment Variables:**
```env
PORT=5000
NODE_ENV=development
DATABASE_PATH=./database/dj-library.db
MUSIC_LIBRARY_PATH=/path/to/your/music/library
TEMP_FOLDER=./temp
UPLOADS_FOLDER=./uploads
JWT_SECRET=your-super-secret-jwt-key-here
CORS_ORIGIN=http://localhost:3000
SERATO_PATH=/path/to/serato  # Optional, auto-detected
```

#### **Frontend Environment Variables:**
```env
REACT_APP_API_URL=http://localhost:5000/api
REACT_APP_WS_URL=ws://localhost:5000
REACT_APP_APP_NAME=DJ Library Manager
REACT_APP_VERSION=1.0.0
```

#### **Key Dependencies to Remember:**
- **Backend**: express, sqlite3, better-sqlite3, music-metadata, fluent-ffmpeg, node-fft, wav-decoder, xml2js, chokidar, jsonwebtoken, bcryptjs
- **Frontend**: @reduxjs/toolkit, react-redux, @tanstack/react-query, react-router-dom, axios, howler, sonner, lucide-react

### ğŸµ **Project Goals**
Build a professional-grade DJ library management system that:
- Analyzes audio features automatically (BPM, key, energy, mood)
- Organizes music intelligently with smart crates
- Integrates seamlessly with Serato DJ software
- Provides real-time updates and notifications
- Offers a beautiful, responsive UI optimized for DJs
- Supports CLI for power users
- Scales to handle 10,000+ tracks efficiently

---

## Instructions for Claude Code Agent

You are continuing development of this DJ Library Manager project. The foundation is set up, but core functionality needs to be implemented. Start by:

1. **Analyzing the current codebase** in the IDE
2. **Creating the backend services** starting with `server.ts`, `DatabaseService.js`, and `AudioAnalyzer.js`
3. **Implementing API routes** for all endpoints
4. **Completing frontend components** with full functionality
5. **Testing integration** between frontend and backend
6. **Ensuring code quality** with TypeScript, error handling, and best practices

Focus on building production-ready, well-documented code that follows the established patterns and architecture. The user is a Senior Frontend Developer with experience in React Native, Flutter, and fintech/health-tech solutions.

All file paths, configurations, and architectural decisions are documented above. Proceed with implementing the core functionality, starting with the highest priority backend services.